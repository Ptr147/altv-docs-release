<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html class="theme-dark">
  
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>&#21517;&#23383;&#26631;&#31614;&#31034;&#20363; </title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="title" content="&#21517;&#23383;&#26631;&#31614;&#31034;&#20363; ">
    <meta name="generator" content="docfx 2.58.0.0">
    
    <link rel="shortcut icon" href="../../favicon.ico">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.2/jquery.modal.min.css" integrity="sha512-T3VL1q6jMUIzGLRB9z86oJg9PgF7A55eC2XkB93zyWSqQw3Ju+6IEJZYBfT7E9wOHM7HCMCOZSpcssxnUn6AeQ==" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.3.1/styles/stackoverflow-dark.min.css" integrity="sha512-Xn1b0y/BrCD7usnEh6r9CcKxHXFVleVUjGDnfc95zDDwFUwtOz3lJC/XtJcuLRNyrMQJEEToFfwjC9Ue/aWY/g==" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.3.1/styles/stackoverflow-light.min.css" integrity="sha512-RDtnAhiPytLVV3AwzHkGVMVI4szjtSjxxyhDaH3gqdHPIw5qwQld1MVGuMu1EYoof+CaEccrO3zUVb13hQFU/A==" crossorigin="anonymous" disabled="disabled">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/solid.min.css" crossorigin="anonymous">
    <link rel="stylesheet" href="../../styles/colors.css">
    <link rel="stylesheet" href="../../styles/discord.css">
    <link rel="stylesheet" href="../../styles/main.css">
    <meta property="docfx:navrel" content="../../toc.html">
    <meta property="docfx:tocrel" content="../../toc.html">
    
    <meta property="docfx:rel" content="../../">
    
  </head>

  <body>

        <div class="body-content">

            <nav id="sidebar" role="navigation">

                <div class="sidebar">
                    
                    
                    
                    
                    <div>
                      
                      <a class="brand" href="../../index.html">
                        <img src="../../logo.svg" alt="alt:V" class="logomark">
                        <span class="brand-title">alt:V</span>
                      </a>
                      <div id="navbar">
                    
                      </div>
                    
                    </div>
                    


                </div>


            </nav>

            <main class="main-panel">

                <div class="blackout desktop-hide"></div>

                    
                    <div class="subnav navbar navbar-default">
                      <button class="btn-link search-back desktop-hide"></button>
                      <button class="btn-link navbar-toggler" aria-label="Toggle navigation"></button>
                      <div class="container" id="breadcrumb">
                        <ul class="breadcrumb">
                          <li></li>
                        </ul>
                      </div>
                      <div class="flex-space"></div>
                      <div class="toolbar">
                          <div style="position: relative; margin: 0 8px;">
                            <form class="search-bar mobile-hide" role="search" id="search" style="position: relative;">
                              <button class="btn-link clear" id="search-query-clear"></button>
                              <div role="textbox" class="form-control" id="search-query" placeholder="Search" contenteditable="true"></div>
                            </form>
                            <div class="popout" id="search-menu">
                                <button class="btn-link search-help" data-href="../../articles/search_help.html"></button>
                              <span class="title">
                                Search options:
                              </span>
                            </div>
                            <button class="btn-link search-tip desktop-hide"></button>
                          </div>
                      </div>
                      <button class="btn-link btn-floating search desktop-hide"></button>
                      <div class="theme">
                        <button class="btn-link theme" aria-label="Switch theme"></button>
                        <div class="popout" id="theme-menu">
                          <div class="theme-option light" data-theme="light">
                            <span class="btn-link theme-light">Light</span>
                          </div>
                          <div class="theme-option dark" data-theme="dark">
                            <span class="btn-link theme-dark">Dark</span>
                          </div>
                          <div class="theme-option auto" data-theme="auto">
                            <span class="btn-link theme-auto">Sync with OS</span>
                          </div>
                        </div>
                      </div>
                    </div>

                <div class="content-region" role="main">

                    <div class="content-column Conceptual">

                            
                            <div class="sideaffix hide-when-search" data-noindex="">
                              <h3>Index</h3>
                              <div class="bs-docs-sidebar affix" id="affix"><ul class="level1 nav bs-docs-sidenav"><li><a href="#名字标签示例">名字标签示例</a><ul class="level2 nav bs-docs-sidenav 名字标签示例"><li><a href="#要求">要求</a></li><li><a href="#创建rml文档">创建rml文档</a></li><li><a href="#创建客户端脚本">创建客户端脚本</a></li><li><a href="#总结">总结</a></li></ul></li></ul></div>
                            </div>

                            
                            <div id="search-results">
                              <div class="search-list">Search Results for <span></span></div>
                              <div class="sr-items">
                                <p><span class="glyphicon glyphicon-refresh index-loading"></span></p>
                              </div>
                              <ul id="pagination" data-first="" data-prev="&#xf053;" data-next="&#xf054;" data-last=""></ul>
                            </div>

                        <article class="content wrap hide-when-search" id="_content" data-uid="">

                                <span class="small pull-right article mobile-hide" style="margin: 0;" data-noindex="">
                                    <ul class="subnav contribution">
                                            <li>
                                                <a href="https://github.com/Ptr147/altv-docs-cn/blob/master/articles/rmlui/nametags.md/#L1">Improve this Doc</a>
                                            </li>
                                    </ul>
                                </span>

<h1 id="名字标签示例">名字标签示例</h1>

<p>本文介绍名称标签作为RmlUi示例。
此示例使用的所有文件可以在以下<a href="https://github.com/altmp/altv-example-resources/tree/master/rml-nametags">仓库</a>中找到。</p>
<h2 id="要求">要求</h2>
<ul>
<li>一些代码编辑器(例如Visual Studio Code)</li>
<li>基本的HTML和CSS知识</li>
<li>字体文件(.ttf)</li>
<li>空资源与<code>Client</code>子文件夹和<code>Client/main.js</code>作为入口点</li>
</ul>
<h2 id="创建rml文档">创建rml文档</h2>
<div class="TIP">
<h5>Tip</h5>
<p>在此示例中使用<code>arialbd.ttf</code>作为字体,可以在上面提到的仓库中找到。</p>
</div>
<p>创建Rml文档相对简单,除了前导<code>&lt;rml&gt;</code>标签和XHTML1标准之外,与创建.html文件没有什么不同。<br>
我们在<code>Client</code>子文件夹中创建<code>index.tml</code>文件,并在其中添加如下内容:</p>
<pre><code class="lang-html">&lt;!-- 对RML UI文档来说,我们的HTML必须以&lt;rml&gt; 标签开始 --&gt; 
&lt;rml&gt; 
     &lt;!-- 其他的全是基于XHTML 1标准的HTML --&gt; 
    &lt;head&gt;
        &lt;title&gt;演示&lt;/title&gt;
        &lt;style&gt;
            body, #nametag-container {
                &lt;!-- 字体需要包含我们后面要加载的字体文件 --&gt;     
                font-family: arial;
                font-weight: bold;
                font-style: normal;
                font-weight: bold;

                width: 100%;
                height: 100%;
            }

            .nametag {
                position: absolute;
                font-effect: outline(1px black);
                color: #FFFFFFFF;
                width: auto;
                height: auto;
                text-align: center;
                font-size: 20dp;
            }

            .hide {
                display: none;
            }

        &lt;/style&gt;
    &lt;/head&gt;
    &lt;body&gt;
    &lt;!-- 这是我们后面客户端脚本中将使用的容器 --&gt; 
    &lt;div id=&quot;nametag-container&quot;&gt;&lt;/div&gt;
    &lt;/body&gt;
&lt;/rml&gt;
</code></pre>
<h2 id="创建客户端脚本">创建客户端脚本</h2>
<div class="TIP">
<h5>Tip</h5>
<p>尽管这个示例中使用了JavaScript,它也可以与C#和其他模块一起使用。
可以在各个模块的文档中找到更多信息。</p>
</div>
<p>创建我们的<code>index.rml</code>后,我们在同一文件夹中创建名为<code>main.js</code>的脚本文件。
在这个文件中,我们添加以下内容,稍后将根据注释对其进行详细说明:</p>
<pre><code class="lang-js">import * as alt from &quot;alt-client&quot;;
import * as native from &quot;natives&quot;;

// ---------------- 配置 ---------------- 
// showVehicleIds:`true` 如果为true,车辆的姓名标签也将包含其ID 
// showPlayerIds:`true` 如果为true,玩家的姓名标签将包含其ID 
// showPlayerNames:`true` 如果为true,玩家的姓名标签将包含其名称 
// checkLoS:`true` 如果为true,需要视线才能绘制姓名标签 
// dynamicSize:`true` 如果为true,大小会根据实体的距离增加或减小 
// controlKey:`79` 激活或停用RML控件的切换键。79是O键 
// 
// 注意:对于玩家,要么启用ID,要么启用名称,要么两者都启用,否则不会绘制姓名标签

const showVehicleIds = true;
const showPlayerIds = true;
const showPlayerNames = true;
const checkLoS = true;
const dynamicSize = true;
const controlKey = 79;

// --------------- Prototype --------------
// We use a custom prototype on the RmlElement to quickly check if its currently drawn or not

alt.RmlElement.prototype.shown = false;

/ ---------------- 脚本 ----------------
// 所有的代码。每行都会包含更详细的说明 
// 对于RML,您必须加载需要的字体,以便可以使用它 

alt.loadRmlFont(&quot;/Client/arialbd.ttf&quot;, &quot;arial&quot;, false, true);
// 创建一个新的RML文档。这类似于创建一个新的Web视图
const document = new alt.RmlDocument(&quot;/Client/index.rml&quot;);
// 我们存储nametag-container以供进一步使用,例如添加和删除姓名标签
const container = document.getElementByID(&quot;nametag-container&quot;);
// 我们使用map简化实体和RmlElement之间的映射
const nameTags = new Map();
// 这个变量将存储我们每次滴答的ID,以便在没有姓名标签要绘制时立即禁用它
let tickHandle = undefined;

// 我们将使用gameEntityCreate事件向容器添加新姓名标签
alt.on(&quot;gameEntityCreate&quot;, (entity) =&gt; {
    // 创建一个&lt;button&gt; HTML元素并将其存储在rmlElement变量中
    const rmlElement = document.createElement(&quot;button&quot;);
    // 设置HTML元素的id属性
    rmlElement.id = entity.id.toString();
    // 添加我们的类以应用样式
    rmlElement.addClass(&quot;nametag&quot;);
    rmlElement.addClass(&quot;hide&quot;);

    // 根据顶部的配置,我们会根据配置绘制不同的姓名标签 
    // 如果没有配置适用于实体类型,我们将销毁RmlElement
    if (entity instanceof alt.Player) {
        if (showPlayerIds &amp;&amp; !showPlayerNames)
            rmlElement.innerRML = `ID: ${entity.id}`;
        else if (showPlayerIds &amp;&amp; showPlayerNames)
            rmlElement.innerRML = `ID: ${entity.id} | Name: ${entity.name}`;
        else if (!showPlayerIds &amp;&amp; showPlayerNames)
            rmlElement.innerRML = `Name: ${entity.name}`;
        else {
            rmlElement.destroy();
            return;
        }
    } else if (entity instanceof alt.Vehicle &amp;&amp; showVehicleIds)
        rmlElement.innerRML = `ID: ${entity.id}`;
    else {
        rmlElement.destroy();
        return;
    }

    // 将RmlElement和Entity添加到我们的map中 
    nameTags.set(entity, rmlElement);
    // 将RmlElement添加到我们的RmlDocument。一旦删除了“hide”类,它就会被绘制 
    container.appendChild(rmlElement);
    // 我们订阅单击事件,以便在需要时打印出实体坐标 
    rmlElement.on(&quot;click&quot;, printCoordinates);

    // 如果已经激活了everyTick,我们可以直接返回,否则我们将启动我们的everyTick 
    if (tickHandle !== undefined) return;
    tickHandle = alt.everyTick(drawMarkers);
});

// 与gameEntityCreate事件相同,但在这里我们将删除姓名标签 
alt.on(&quot;gameEntityDestroy&quot;, (entity) =&gt; {
    // 我们从地图中获取实体的rmlElement 
    const rmlElement = nameTags.get(entity);
    // 如果没有找到,例如因为创建条件不匹配,我们可以在这里直接返回 
    if (rmlElement === undefined) return;
    // 从容器中删除RmlElement...... 
    container.removeChild(rmlElement);
     // ...并结束其存在。
    rmlElement.destroy();
     // 从姓名标签映射中删除 
    nameTags.delete(entity);

    // 如果没有更多的姓名标签剩下,我们停止每次滴答以节省性能 
    if (tickHandle === undefined || nameTags.size &gt; 0) return;
    alt.clearEveryTick(tickHandle);
    tickHandle = undefined;
});

// 我们使用keyup事件启用或禁用控件 
alt.on(&quot;keyup&quot;, (key) =&gt; {
    // 如果键不是我们的控制键,我们不需要任何进一步处理 
    if (key !== controlKey) return;

    // 获取当前的控制状态 
    const currentState = alt.rmlControlsEnabled();
    if (currentState) {
       // 如果已经启用,则禁用控件...... 
        alt.toggleGameControls(true);
        alt.showCursor(false);
        alt.toggleRmlControls(false);
    } else {
        // 或者如果已禁用,则启用
        alt.toggleGameControls(false);
        alt.showCursor(true);
        alt.toggleRmlControls(true);
    }
});

// 此功能来自单击事件 
// 事件参数可以在rmlui文档中找到:https://mikke89.github.io/RmlUiDoc/pages/rml/events.html 
function printCoordinates(rmlElement, eventArgs) {
    // 在这里我们访问先前设置给rmlElement的id 
    const entity = alt.Entity.getByID(parseInt(rmlElement.id));
    alt.log(&quot;Entity Position&quot;, &quot;X&quot;, entity.pos.x, &quot;Y&quot;, entity.pos.y, &quot;Z&quot;, entity.pos.z);
}

// 此功能来自我们的everyTick 
function drawMarkers() {
    // 我们循环遍历地图中的所有实体
    nameTags.forEach((rmlElement, entity) =&gt; {
        // 获取它们的位置 
        const {x, y, z} = entity.pos;

        // 检查它们是否在屏幕上,并且如果启用了视线检查,则在我们之间没有障碍, 
        if (!native.isSphereVisible(x, y, z, 0.0099999998) || (checkLoS &amp;&amp; !native.hasEntityClearLosToEntity(alt.Player.local, entity, 17))) {
            // 如果我们看不到它,并且RmlElement已经隐藏,我们可以直接返回 
            if (!rmlElement.shown) return;

            // 否则我们要通过添加css类来隐藏它......
            rmlElement.addClass(&quot;hide&quot;);
             // ...并设置我们的自定义属性
            rmlElement.shown = false;
        } else {
            // 实体可见,所以我们检查RmlElement是否仍然隐藏 
            if (!rmlElement.shown) {
                 // 如果是,我们删除隐藏类...... 
                rmlElement.removeClass(&quot;hide&quot;);
                // ...并将shown属性设置为true 
                rmlElement.shown = true;
            }

            // 现在我们获取实体的屏幕坐标
            const {x: screenX, y: screenY} = alt.worldToScreen(x, y, z + 2);
            // 并将其应用于我们的RmlElement
            rmlElement.style[&quot;left&quot;] = `${screenX}px`;
            rmlElement.style[&quot;top&quot;] = `${screenY}px`;

            // 如果动态大小被禁用,我们可以简单地在这里返回...... 
            if (!dynamicSize) return;
            // ...否则我们检查距离,在这个例子中,我们将使用最小尺寸1dp和最大尺寸50dp 
            // 这将根据从1到100米的距离应用。低于或高于的所有内容将使用
            // 1或50作为字体大小。
            const fontSizeModificator = Math.min(entity.pos.distanceTo(alt.Player.local.pos) / 100, 1);
            const fontSize = (1 - fontSizeModificator) * 50;
            // 计算后,我们修改样式属性以使用新的字体大小
            rmlElement.style[&quot;font-size&quot;] = `${fontSize}dp`;
        }
    });
}
</code></pre>
<h2 id="总结">总结</h2>
<p>在我们同时创建了<code>index.rml</code>和<code>main.js</code>以及添加了字体文件之后,RmlUi 资源已经准备就绪。</p>
<p>尤其值得注意的是,HTML元素可以直接通过客户端代码控制,因此可以在没有事件的情况下进行更新。<br>
这就是RmlUi可以达到更高性能的原因之一。</p>
</article>
                    </div>

                </div>

            </main>

        </div>

        
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/arrive/2.4.1/arrive.min.js" integrity="sha512-wkU3qYWjenbM+t2cmvw2ADRRh4opbOYBjkhrPGHV7M6dcE/TR0oKpoDkWXfUs3HrulI2JFuTQyqPLRih1V54EQ==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/twbs-pagination/1.4.2/jquery.twbsPagination.min.js" integrity="sha512-frFP3ZxLshB4CErXkPVEXnd5ingvYYtYhE5qllGdZmcOlRKNEPbufyupfdSTNmoF5ICaQNO6SenXzOZvoGkiIA==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha512-mhbv5DqBMgrWL+32MmsDOt/OAvqr/cHimk6B8y/bx/xS88MVkYGPiVv2ixKVrkywF2qHplNRUvFsAHUdxZ3Krg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.2/jquery.modal.min.js" integrity="sha512-ztxZscxb55lKL+xmWGZEbBHekIzy+1qYKHGZTWZYH1GUwxy0hiA18lW6ORIMj4DHRgvmP/qGcvqwEyFFV7OYVQ==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.3.0/anchor.min.js" integrity="sha512-G2OGlm41XXw+fcgDcRPjVYEn7qCY6qiKWNqDGT37SnKh0qtRXTuKZ5/UQR0kDN0PZRNWcGExd3lAeqEH0I36bQ==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/js-url/1.8.8/url.min.js" integrity="sha512-r7Z8tYN1iMr6CTQ7pNJa2q+3owm4Tc6dLkVzGV68AFGiI0muMh5eLVQlas5kb9qwPY168HsTBctUwn3k0FVqyw==" crossorigin="anonymous"></script>
<script type="text/javascript" src="../../styles/docfx.js"></script>
<script type="text/javascript" src="../../styles/discord.js"></script>
<script type="text/javascript" src="../../styles/main.js"></script>

    </body>

</html>
